can # ğŸ“š Architecture & Data Flow Guide

## ğŸ—ï¸ System Architecture Overview

The Book Summarizer system follows a **modular, domain-driven architecture** with clear separation of concerns:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CLI Entry Point                          â”‚
â”‚                 book_processor.py                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Orchestrator                                â”‚
â”‚              book_processing/main.py                        â”‚
â”‚                   (45 lines)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                       â”‚
              â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     PDF Processor       â”‚ â”‚    EPUB Processor       â”‚
â”‚   Complete Workflow     â”‚ â”‚   Complete Workflow     â”‚
â”‚     (200 lines)         â”‚ â”‚     (400 lines)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                           â”‚
          â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Shared Components                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ TOC Parser  â”‚ â”‚Chapter      â”‚ â”‚Report       â”‚           â”‚
â”‚  â”‚             â”‚ â”‚Detector     â”‚ â”‚Generator    â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚EPUB Image   â”‚ â”‚HTMLâ†’PDF     â”‚ â”‚Utilities    â”‚           â”‚
â”‚  â”‚Extractor    â”‚ â”‚Converter    â”‚ â”‚             â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Data Flow Diagrams

### PDF Processing Workflow
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PDF File â”‚â”€â”€â”€â–¶â”‚ TOC Parser  â”‚â”€â”€â”€â–¶â”‚ Chapter      â”‚â”€â”€â”€â–¶â”‚ Page Range  â”‚
â”‚          â”‚    â”‚             â”‚    â”‚ Detector     â”‚    â”‚ Calculator  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚Final Report â”‚â—€â”€â”€â”€â”‚ PDF         â”‚â—€â”€â”€â”€â”‚ Directory    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚& Cleanup    â”‚    â”‚ Extractor   â”‚    â”‚ Creator      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### EPUB Processing Workflow  
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EPUB File â”‚â”€â”€â”€â–¶â”‚ Direct      â”‚â”€â”€â”€â–¶â”‚ Chapter      â”‚â”€â”€â”€â–¶â”‚ Image       â”‚
â”‚           â”‚    â”‚ Extraction  â”‚    â”‚ Classificationâ”‚    â”‚ Extraction  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚Final Report â”‚â—€â”€â”€â”€â”‚ PDF         â”‚â—€â”€â”€â”€â”‚ HTML         â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚& Cleanup    â”‚    â”‚ Conversion  â”‚    â”‚ Creation     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### AI Summarization Workflow
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PDF Chapter â”‚â”€â”€â”€â–¶â”‚ Text        â”‚â”€â”€â”€â–¶â”‚ Content      â”‚â”€â”€â”€â–¶â”‚ AI API      â”‚
â”‚             â”‚    â”‚ Extraction  â”‚    â”‚ Validation   â”‚    â”‚ Call        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚ Markdown    â”‚â—€â”€â”€â”€â”‚ Summary     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ File        â”‚    â”‚ Processing  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Core Design Principles

### 1. **Single Responsibility Principle**
Each module has one clear purpose:
- **main.py**: Pure orchestration and routing
- **pdf_processor.py**: Complete PDF workflow 
- **epub_processor.py**: Complete EPUB workflow
- **toc_parser.py**: Table of Contents parsing only
- **chapter_detector.py**: Chapter detection algorithms only

### 2. **Delegation Pattern**
```python
# main.py delegates all implementation details
class BookProcessor:
    def _process_pdf_book(self, pdf_path, output_dir):
        return self.pdf_processor.process_pdf_book(pdf_path, output_dir)
    
    def _process_epub_book(self, epub_path, output_dir):
        return self.epub_processor.process_epub_book(epub_path, output_dir)
```

### 3. **Dependency Injection**
Each processor receives its dependencies at initialization:
```python
class PDFProcessor:
    def __init__(self, verbose=False):
        self.toc_parser = TOCParser(verbose=verbose)
        self.chapter_detector = ChapterDetector(verbose=verbose)
        self.report_generator = ReportGenerator(verbose=verbose)
```

### 4. **Error Boundaries**
Each processor handles its own errors and provides graceful degradation:
```python
try:
    # Complex processing logic
    return self.process_book(pdf_path, output_dir)
except Exception as e:
    print(f"âŒ Processing failed: {e}")
    if self.verbose:
        traceback.print_exc()
    return False
```

---

## ğŸ“Š Component Interactions

### PDF Processing Components
```
PDFProcessor
â”œâ”€â”€ Uses: TOCParser
â”‚   â”œâ”€â”€ find_toc_pages()
â”‚   â””â”€â”€ extract_chapters_from_toc()
â”œâ”€â”€ Uses: ChapterDetector  
â”‚   â”œâ”€â”€ scan_for_chapters()
â”‚   â”œâ”€â”€ merge_toc_with_pages()
â”‚   â””â”€â”€ calculate_page_ranges()
â”œâ”€â”€ Uses: ReportGenerator
â”‚   â”œâ”€â”€ create_extraction_preview()
â”‚   â”œâ”€â”€ generate_processing_report()
â”‚   â””â”€â”€ print_processing_summary()
â””â”€â”€ Internal: PDF Extraction
    â”œâ”€â”€ create_chapter_pdfs()
    â””â”€â”€ _create_pdf_section_directories()
```

### EPUB Processing Components  
```
EPUBProcessor
â”œâ”€â”€ Uses: EPUBImageExtractor
â”‚   â””â”€â”€ extract_chapter_images()
â”œâ”€â”€ Uses: HTMLToPDFConverter
â”‚   â”œâ”€â”€ convert_html_to_pdf()
â”‚   â””â”€â”€ _cleanup_image_folder()
â”œâ”€â”€ Uses: ReportGenerator  
â”‚   â”œâ”€â”€ generate_processing_report()
â”‚   â””â”€â”€ print_processing_summary()
â””â”€â”€ Internal: EPUB Extraction
    â”œâ”€â”€ _extract_epub_chapters_direct()
    â”œâ”€â”€ _extract_epub_title()
    â””â”€â”€ _create_epub_chapter_html_with_images()
```

### AI Summarization Components
```
ChatGPTSummarizer / ClaudeSummarizer
â”œâ”€â”€ Uses: PDFTextExtractor
â”‚   â”œâ”€â”€ extract_text_from_pdf()
â”‚   â””â”€â”€ check_content_length()
â”œâ”€â”€ Uses: PromptTemplate
â”‚   â””â”€â”€ get_summarization_prompt()
â””â”€â”€ Internal: API Integration
    â”œâ”€â”€ summarize_chapter()
    â”œâ”€â”€ save_summary()
    â””â”€â”€ process_folder()
```

---

## ğŸ—ƒï¸ Data Models & Structures

### Chapter Data Structure
```python
chapter = {
    'id': str,                    # Chapter identifier (1, 2, 3...)
    'title': str,                 # Full chapter title
    'start_page': int,            # Starting page number (1-based)
    'end_page': int,              # Ending page number (1-based)
    'page_range': str,            # Human readable range ("pages 1-15")
    'section': str,               # Section letter (A, B, C) or None
    'section_title': str,         # Section name or None
    'source': str,                # Detection method ('toc', 'pattern', 'manual')
    'text_length': int,           # Character count (EPUB only)
    'content': bytes,             # Raw content (EPUB only)
    'item': object               # EPUB item object (EPUB only)
}
```

### Processing Report Structure
```python
report = {
    'book_info': {
        'book_name': str,         # Base filename without extension
        'file_type': str,         # 'PDF' or 'EPUB'
        'total_chapters': int,    # Number of chapters found
        'total_files': int,       # Number of files created
        'processing_date': str    # ISO-8601 timestamp
    },
    'chapters': [chapter],        # Array of chapter objects
    'extracted_files': [str]      # Array of output file paths
}
```

### Section Directory Mapping
```python
section_dirs = {
    'Product Skills': '/path/to/C._Product_Skills/',
    'Technical Skills': '/path/to/D._Technical_Skills/',
    'Chapters': '/path/to/Chapters/'  # Flat structure fallback
}
```

---

## ğŸ”„ State Management

### Processing State Flow
```
INITIALIZED â†’ PARSING â†’ DETECTING â†’ EXTRACTING â†’ REPORTING â†’ COMPLETE
     â”‚           â”‚          â”‚           â”‚           â”‚           â”‚
     â–¼           â–¼          â–¼           â–¼           â–¼           â–¼
   Ready    TOC Found   Chapters    Files      Reports     Success
            â”‚          Detected    Created    Generated      â”‚
            â–¼              â”‚          â”‚           â”‚         â–¼
         Failed            â–¼          â–¼           â–¼      Cleanup
                      Failed     Failed      Failed
```

### Error Handling Strategy
1. **Fail Fast**: Validate inputs before processing
2. **Graceful Degradation**: Continue with partial results when possible  
3. **User Feedback**: Clear error messages and recovery suggestions
4. **Cleanup**: Remove partial files on failure
5. **Logging**: Detailed logs in verbose mode

---

## ğŸ§© Extension Points

### Adding New Book Formats
```python
# 1. Create new processor
class NewFormatProcessor:
    def process_book(self, file_path, output_dir):
        # Implementation here
        pass

# 2. Register in main.py
def process_book(self, file_path, output_dir):
    extension = file_path.suffix.lower()
    if extension == '.newformat':
        return self.new_format_processor.process_book(file_path, output_dir)
```

### Adding New AI Providers
```python
# 1. Create new summarizer
class NewAISummarizer:
    def __init__(self, api_key):
        # Initialize API client
    
    def summarize_chapter(self, chapter_path):
        # Call new AI API
        pass

# 2. Use shared components
# - pdf_text_extractor.py (text extraction)
# - prompt_template.py (prompts)
```

### Adding New Output Formats
```python
# 1. Create new converter
class HTMLToNewFormatConverter:
    def convert(self, html_path, output_path):
        # Convert HTML to new format
        pass

# 2. Integrate in EPUB processor
def _process_epub_chapters(self):
    # ... existing logic ...
    converter.convert(html_path, new_format_path)
```

---

## ğŸ”’ Security Architecture

### API Key Management
```
.env file â†’ python-dotenv â†’ Environment Variables â†’ API Clients
    â”‚                                â”‚
    â–¼                                â–¼
.gitignore                     Validation & Error Handling
(excluded)                          â”‚
                                   â–¼
                              Secure Usage in AI Calls
```

### File System Security
- **Input Validation**: Verify file types and accessibility
- **Path Sanitization**: Clean filenames for cross-platform compatibility
- **Temporary Files**: Automatic cleanup of intermediate files
- **Permission Checking**: Verify write access before processing

### Memory Management
- **Context Limits**: Validate content size before API calls
- **Chunked Processing**: Handle large files in segments
- **Resource Cleanup**: Proper disposal of file handles and memory
- **Error Recovery**: Rollback mechanisms for failed operations

---

## ğŸ“ˆ Performance Characteristics

### Bottlenecks & Optimizations
1. **TOC Parsing**: O(n) where n = number of pages to scan
2. **Chapter Detection**: O(m) where m = total pages in book
3. **Image Extraction**: O(k) where k = number of images
4. **PDF Conversion**: O(p) where p = number of chapters
5. **AI Summarization**: O(s) where s = API response time

### Scaling Considerations
- **Parallel Processing**: Can process multiple books simultaneously
- **Memory Usage**: ~50-200MB per book (depends on content)
- **Disk I/O**: Sequential file operations, optimized for SSDs
- **Network**: API calls are rate-limited by providers
- **CPU**: Moderate usage, mostly I/O bound operations

### Monitoring Points
- **Processing Time**: Track time per operation
- **Success Rate**: Monitor failed vs successful extractions
- **API Usage**: Track token consumption and costs
- **File Sizes**: Monitor output file sizes and disk usage
- **Error Patterns**: Identify common failure modes

This architecture provides a solid foundation for book processing with clear extension points for future enhancements.